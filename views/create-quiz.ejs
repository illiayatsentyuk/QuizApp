<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/create-quiz.css">
    <script src="/js/script.js"></script>
    <title>Create Quiz</title>
</head>
<body>
    <header>
        <a href="/create-quiz">Create Quiz</a>
        <a href="/all-quizzes">All Quizzes</a>
        <a href="/all-questions">All Questions</a>
        <a href="/find-quiz">Search Quiz</a>
        <a href="/">Home</a>
    </header>
    <h1>Create New Quiz</h1>
    <div class="create-quiz-container">
        <label for="quiz-name">Quiz Name</label>
        <input type="text" id="quiz-name" placeholder="Enter the name of your quiz">
        
        <label for="quiz-category">Quiz Category</label>
        <input type="text" id="quiz-category" placeholder="Enter the category (e.g., Science, History)">
        
        <label for="quiz-form">Quiz Form</label>
        <input type="text" id="quiz-form" placeholder="Enter the quiz form">
        
        <label for="quiz-questions">Quiz Questions</label>
        <div class="format-help">
            Format: Question;Option1 Option2 Option3 Option4;CorrectAnswer
            <br>
            Add each question on a new line
        </div>
        <textarea id="quiz-questions" 
                  placeholder="Example:&#10;What is the capital of France?;Paris London Berlin Madrid;Paris&#10;Which planet is closest to the sun?;Venus Mercury Mars Earth;Mercury"></textarea>
        
        <button id="create-quiz">Create Quiz</button>
    </div>
</body>
</html>
<script>
    window.onload = function () {
        const quizName = document.querySelector("#quiz-name");
        const quizCategory = document.querySelector("#quiz-category");
        const quizForm = document.querySelector("#quiz-form");
        const quizQuestions = document.querySelector("#quiz-questions");
        const quizCorrectAnswers = document.querySelector("#quiz-correct-answers");
        const createQuiz = document.querySelector("#create-quiz");
        createQuiz.addEventListener("click", () => {
            const array = []
            const quizArray = quizQuestions.value.trim().split("\n");
            const quizQuestionsArray = quizArray.map(el => el.split(";")[0]);
            const quizAnswersArray = quizArray.map(el => el.split(";")[1]);
            console.log(quizAnswersArray);
            const quizNewAnswersArray = quizAnswersArray.map(el => el.split(" "));
            const quizCorrectAnswersArray = quizArray.map(el => el.split(";")[2]);
            for (let i = 0; i < quizQuestionsArray.length; i++) {
                array.push({
                    text: quizQuestionsArray[i],
                    answ: quizNewAnswersArray[i],
                    correct: quizCorrectAnswersArray[i]
                })
            }
            console.log({
                    name: quizName.value,
                    category: quizCategory.value,
                    form: quizForm.value,
                    questions: array,
                });
            fetch("http://localhost:3000/quiz", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    name: quizName.value,
                    category: quizCategory.value,
                    form: quizForm.value,
                    questions: array,
                }),
            }).then(res => res.json()).then(data => {
                console.log(data);
                location.href = '/getQuizById?id=' + data.quiz._id;   
            }).catch(err => {
                console.log(err);
            });
        });
    };
</script>
